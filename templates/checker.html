<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Spam Checker</title>

<!-- ROBOTO -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body{
  background:#f8fcfc;
  font-family:Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

/* CARD */
.box{
  background:#ffffff;
  width:520px;
  padding:40px;
  border-radius:22px;
  box-shadow:0 30px 70px rgba(15,23,42,0.08);
}

/* TITLE */
h2{
  font-family:"Roboto", sans-serif;
  font-size:30px;
  font-weight:700;
  color:#0f172a;
  margin-bottom:6px;
}

/* SUBTEXT */
.subtitle{
  font-size:15px;
  color:#64748b;
  margin-bottom:16px;
}

/* HELPER */
.helper{
  font-size:14px;
  color:#475569;
  margin-bottom:8px;
}

/* TEXTAREA */
textarea{
  width:100%;
  height:130px;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid #e5eff0;
  font-size:15px;
  outline:none;
}

textarea::placeholder{
  color:#94a3b8;
}

textarea:focus{
  border-color:#0ea5a4;
  box-shadow:0 0 0 3px rgba(14,165,164,0.15);
}

/* BUTTON */
button{
  width:100%;
  padding:14px;
  margin-top:18px;
  border:none;
  border-radius:14px;
  background:#0ea5a4;
  color:white;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:0.2s ease;
}

button:hover{
  background:#0891b2;
}

/* SECONDARY BUTTON */
.advice-btn{
  background:#0f172a;
}

.advice-btn:hover{
  background:#020617;
}

/* RESULT */
.result{
  margin-top:18px;
  line-height:1.7;
  font-size:15px;
  color:#0f172a;
}

/* STATUS COLORS */
.fake{
  color:#dc2626;
  font-weight:600;
}

.safe{
  color:#16a34a;
  font-weight:600;
}

/* PRIVACY */
.privacy{
  margin-top:16px;
  font-size:13px;
  color:#94a3b8;
  text-align:center;
}
</style>
</head>

<body>

<div class="box">
  <h2>Spam Checker</h2>
  <p class="subtitle">
    Paste any message below to instantly check if it is safe or potentially a scam.
  </p>

  <p class="helper">
    You can check SMS, emails, job offers, payment requests, or shared links.
  </p>

  <textarea id="email" placeholder="Paste email or message here..."></textarea>

  <button onclick="checkEmail()">Check Message</button>

  <div class="result" id="result"></div>

  <button class="advice-btn" id="nextBtn" onclick="showNextSteps()" style="display:none;">
    What should I do next?
  </button>

  <p class="privacy">
    Your message is analyzed securely and is not stored.
  </p>
</div>

<script>
let lastType = "";
let detectedAdvice = [];

function speakAndType(text, css){
  const box = document.getElementById("result");
  box.innerHTML = "";

  speechSynthesis.cancel();
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";
  speechSynthesis.speak(msg);

  let i = 0;
  const timer = setInterval(() => {
    box.innerHTML = `<span class="${css}">${text.slice(0,i)}</span>`;
    i++;
    if(i > text.length) clearInterval(timer);
  }, 35);
}

async function checkEmail(){
  const text = document.getElementById("email").value;
  const lower = text.toLowerCase();
  const nextBtn = document.getElementById("nextBtn");

  detectedAdvice = [];
  nextBtn.style.display = "none";

  if(!text.trim()){
    document.getElementById("result").innerHTML = "‚ö†Ô∏è Please enter a message";
    return;
  }

  document.getElementById("result").innerHTML = "üîç Analyzing message...";

  const res = await fetch("/predict", {
    method:"POST",
    headers:{ "Content-Type":"application/x-www-form-urlencoded" },
    body:`email=${encodeURIComponent(text)}`
  });

  const data = await res.json();
  const ai = data[0];
  const risk = Math.round(ai.score * 100);

  if(lower.includes("click") || lower.includes("link"))
    detectedAdvice.push("‚ùå Do NOT click suspicious links");

  if(lower.includes("pay") || lower.includes("fee"))
    detectedAdvice.push("‚ùå Do NOT make any payment");

  if(lower.includes("otp") || lower.includes("password"))
    detectedAdvice.push("‚ùå Never share OTP or passwords");

  if(lower.includes("bank") || lower.includes("account"))
    detectedAdvice.push("‚ùå Banks never ask details through messages");

  if(lower.includes("verify") || lower.includes("suspended"))
    detectedAdvice.push("‚ö†Ô∏è Urgency tactic detected");

  if(lower.includes("internship") || lower.includes("job"))
    detectedAdvice.push("‚ùå Genuine internships never ask for money");

  if(ai.label === "LABEL_1"){
    lastType = "fake";
    speakAndType(
      `Scam alert! This message looks dangerous. Risk level ${risk} percent.`,
      "fake"
    );
    nextBtn.style.display = "block";
  } else {
    lastType = "safe";
    speakAndType(
      "This message looks safe. No immediate risk detected.",
      "safe"
    );
    nextBtn.style.display = "block";
  }
}

function showNextSteps(){
  const box = document.getElementById("result");

  if(lastType === "fake"){
    box.innerHTML += `
      <br><br><b>What should you do now?</b><br>
      ${detectedAdvice.join("<br>")}<br>
      ‚Ä¢ Delete the message<br>
      ‚Ä¢ Report or block the sender
    `;
  } else {
    box.innerHTML += `
      <br><br><b>Safety tips</b><br>
      ‚Ä¢ Verify sender details<br>
      ‚Ä¢ Be cautious with links<br>
      ‚Ä¢ Keep personal data private
    `;
  }
}
</script>

</body>
</html>
